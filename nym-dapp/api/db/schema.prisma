datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = "native"
}

model NotaryFeedback {
  id                   Int    @id @default(autoincrement())
  unsubmittedProfileId Int
  feedback             String

  UnsubmittedProfile UnsubmittedProfile @relation(fields: [unsubmittedProfileId], references: [id])

  // We don't use this relation in this direction, but Prisma requires all relations to be listed bidirectionally.
  isUnaddressed UnsubmittedProfile[] @relation("unaddressedFeedback")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([unsubmittedProfileId])
}

model UnsubmittedProfile {
  id         Int     @id @default(autoincrement())
  photoCID   String
  videoCID   String
  ethAddress String  @unique
  email      String?

  unaddressedFeedbackId Int?
  UnaddressedFeedback   NotaryFeedback? @relation("unaddressedFeedback", fields: [unaddressedFeedbackId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  NotaryFeedback NotaryFeedback[]
}

enum ProfileStatus {
  submitted_via_notary
  challenged
  deemed_valid
  deemed_invalid
}

// Cache of profiles populated from the `profiles` storage var in Nym.cairo
model CachedProfile {
  // Fields stored on StarkNet
  profileId            String   @id
  cid                  String
  address              String   @unique
  submitter_address    String
  submission_timestamp DateTime
  is_notarized         Boolean

  // Derived fields
  photoCID String?
  videoCID String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model CachedChallenge {
  profileId String @id

  // TODO: use better data types here
  last_recorded_status            String
  challenge_timestamp             String
  challenger_address              String
  challenge_evidence_cid          String
  profile_owner_evidence_cid      String
  adjudication_timestamp          String
  adjudicator_evidence_cid        String
  did_adjudicator_confirm_profile String
  appeal_timestamp                String
  super_adjudication_timestamp    String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

}
